<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instrumentación Meteorológica</title>
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!-- Bootstrap Icons CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">  
  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css')}}">
</head>

<body class="d-flex flex-column min-vh-100">

  <header>
    <nav class="navbar navbar-dark bg-primary shadow-sm">
      <div class="container">
        <a class="navbar-brand" href="https://www.atmosfera.unam.mx/">
          <img src="/static/images/images.jpg" width="80" height="80">
          <strong>Instrumentación Meteorológica</strong>
        </a>
        <div class="d-flex text-white">
            <span class="me-3">Puerto: <strong id="status-puerto">--</strong></span>
            <span>Sonda: <strong id="status-sonda">--</strong></span>
        </div>
      </div>
    </nav>
  </header>

  <main id="app" class="container my-4 flex-grow-1">
    
    <!-- Vista 1: Portada -->
    <div id="view-portada" class="view active card shadow-sm p-4 text-center">
      <div class="card-body">
        <h1 class="card-title h2">Bienvenido</h1>
        <p class="lead text-muted">Conecte el receptor, encienda la sonda y presione "Conectar" para iniciar, o "Graficar" para analizar datos existentes.</p>
        <div class="d-grid gap-2 d-sm-flex justify-content-sm-center mt-4">
          <button class="btn btn-primary btn-lg" onclick="irAPuertos()">Conectar Sonda</button>
          <button class="btn btn-outline-secondary btn-lg" onclick="irASeleccionarArchivo()">Graficar Archivo</button>
        </div>
      </div>
    </div>

    <!-- Vista 2: Selección de puertos -->
    <div id="view-puertos" class="view card shadow-sm">
      <div class="card-body p-4">
        <h2 class="card-title">Seleccionar Puerto</h2>
        <p class="card-subtitle mb-3 text-muted">Ingrese el puerto COM o TTY donde está conectado el receptor.</p>
        <div class="mensaje alert alert-danger" style="display: none;"></div>
        <div class="mb-3">
          <label for="input-puerto" class="form-label">Nombre del puerto:</label>
          <input type="text" id="input-puerto" class="form-control" placeholder="/dev/ttyS9 o COM3">
        </div>
        <div class="d-flex justify-content-end gap-2">
          <button class="btn btn-secondary" onclick="regresarPortada()">Cancelar</button>
          <button class="btn btn-primary" onclick="aceptarPuerto()">Aceptar</button>
        </div>
      </div>
    </div>

    <!-- Vista 3: Dirección de la sonda -->
    <div id="view-sonda" class="view card shadow-sm">
      <div class="card-body p-4">
        <h2 class="card-title">Configurar Dirección de la Sonda</h2>
        <div class="mensaje" style="display: none;"></div>
        <p>Puerto seleccionado: <strong id="puerto-actual"></strong></p>
        <div class="mensaje alert alert-danger" style="display: none;"></div>
        <div class="mb-3">
            <label for="direccion-sonda" class="form-label">Dirección de la sonda:</label>
            <div class="input-group">
                <input type="text" id="direccion-sonda" class="form-control" placeholder="Ej. 1">
                <button class="btn btn-outline-secondary" onclick="direccionAuto()">Auto</button>
            </div>
        </div>
        <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-secondary" onclick="irAPuertos()">Atrás</button>
            <button class="btn btn-primary" onclick="aceptarDireccion()">Aceptar</button>
        </div>
      </div>
    </div>

    <!-- Vista 4: Menú principal de acciones -->
    <div id="view-menu" class="view card shadow-sm">
        <div class="card-body p-4 text-center">
            <h2 class="card-title">Menú Principal</h2>
            <p class="text-muted">Puerto: <span id="menu-puerto"></span> | Sonda: <span id="menu-sonda"></span>
                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="cambiarSonda()">Cambiar</button>
            </p>
        <div class="my-4">
            <label for="formato-archivo" class="form-label">Formato para recolección:</label>
            <select id="formato-archivo" class="form-select w-50 mx-auto">
                <option value="txt" selected>(.txt)</option>
                <option value="csv">(.csv)</option>
                <option value="cca">(.cca)</option>
            </select>
        </div>

            <div class="row mt-4">
                <div class="col-md-4 mb-3">
                    <button class="btn btn-primary w-100 p-3" onclick="configurarSonda()">Configurar<br>Sonda</button>
                </div>
                <div class="col-md-4 mb-3">
                    <button class="btn btn-success w-100 p-3" onclick="datosTiempoReal()">Datos en<br>Tiempo Real</button>
                </div>
                <div class="col-md-4 mb-3">
                    <button class="btn btn-info w-100 p-3" onclick="recolectarDatos()">Recolectar<br>Datos</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vista 5: Configuración de la sonda -->
    <div id="view-configuracion" class="view card shadow-sm">
      <div class="card-body p-4">
        <h2 class="card-title">Configuración de la Sonda</h2>
        <p class="text-muted">Puerto: <span id="conf-puerto"></span> | Dirección: <span id="conf-sonda"></span></p>

        <fieldset class="mb-3">
            <legend class="h6">Configuración de hora</legend>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="hora" id="hora-pc" value="pc" checked>
                <label class="form-check-label" for="hora-pc">Sincronizar con la PC</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="hora" id="hora-manual" value="manual" disabled>
                <label class="form-check-label" for="hora-manual">Personalizado (no implementado)</label>
            </div>
        </fieldset>
        
        <fieldset>
            <legend class="h6">Configuración de medición</legend>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="intervalo-muestreo" class="form-label">Intervalo de muestreo (s):</label>
                    <input type="number" id="intervalo-muestreo" class="form-control" min="1" max="60" value="10">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="intervalo-almacenamiento" class="form-label">Intervalo de almacenamiento (s):</label>
                    <input type="number" id="intervalo-almacenamiento" class="form-control" min="1" max="60" value="30">
                </div>
            </div>
        </fieldset>

        <div class="d-flex justify-content-end gap-2 mt-4">
            <button class="btn btn-secondary" onclick="cancelarConfiguracion()">Cancelar</button>
            <button class="btn btn-primary" onclick="aceptarConfiguracion()">Guardar Configuración</button>
        </div>
      </div>
    </div>

      <!-- Vista 6: Obtención de los datos -->
    <div id="view-data" class="view card shadow-sm">
      <div class="card-body p-4 text-center">
        <h2 class="card-title">Recolectando Datos de la Sonda</h2>
        <p id="recoleccion-status" class="text-muted">Iniciando comunicación...</p>
        <div class="progress mt-4" style="height: 25px;">
            <div id="recoleccion-progressbar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
        </div>

        <div id="recoleccion-resultado" class="mt-4" style="display: none;">
        </div>

        <div class="mt-4">
            <button id="recoleccion-cancelar-btn" class="btn btn-secondary" onclick="cancelarRecoleccion()">Cancelar</button>
            <button id="recoleccion-menu-btn" class="btn btn-primary" onclick="mostrarMenuPrincipal()" style="display: none;">Volver al Menú</button>
        </div>
      </div>
    </div>
    <!-- Vista 7: Datos en tiempo real -->
    <div id="view-real" class="view card shadow-sm">
      <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="card-title mb-0">Datos en Tiempo Real</h2>
          <button class="btn btn-secondary" onclick="detenerTiempoReal()">Volver al Menú</button>
        </div>
        <p class="card-subtitle text-muted">Recibiendo datos de la sonda cada 3 segundos...</p>

        <!-- Fila para los indicadores principales -->
        <div class="row mt-4 text-center">
            <div class="col-md-4 mb-3">
                <div class="p-3 border rounded">
                    <h5>Temperatura</h5>
                    <p class="h3" id="real-temp">-- <small class="text-muted">°C</small></p>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="p-3 border rounded">
                    <h5>Humedad</h5>
                    <p class="h3" id="real-hum">-- <small class="text-muted">%</small></p>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="p-3 border rounded">
                    <h5>Presión</h5>
                    <p class="h3" id="real-pres">-- <small class="text-muted">hPa</small></p>
                </div>
            </div>
        </div>

        <div class="row mt-2 text-center">
            <div class="col-md-6 mb-3">
                <div class="p-3 border rounded">
                    <h5>Velocidad del Viento</h5>
                    <p class="h3" id="real-wind-speed">-- <small class="text-muted">m/s</small></p>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="p-3 border rounded">
                    <h5>Dirección del Viento</h5>
                    <!-- Contenedor para la imagen de la flecha -->
                    <img id="wind-rose-img" src="{{ url_for('static', filename='images/FLECHA00.gif') }}" alt="Rosa de los vientos" style="width: 100px; height: 100px; margin-top: 10px;">
                    <p class="h5 mt-2" id="real-wind-dir">-- <small class="text-muted">°</small></p>
                </div>
            </div>
        </div>
      </div>
    </div>

    <!-- Vista 8: Insertar un archivo para graficar -->
    <div id="view-insertar-archivo" class="view card shadow-sm">
      <div class="card-body p-4">
        <h2 class="card-title">Analizar Archivo de Datos</h2>
        <p class="card-subtitle mb-3 text-muted">Seleccione un archivo (.cca, .txt, .csv) para cargarlo y visualizar las gráficas.</p>
        <form id="uploadForm">
            <div class="input-group mb-3">
                <input type="file" class="form-control" id="fileInput" name="archivo" accept=".cca, .txt, .csv" required>
                <button class="btn btn-primary" type="submit">Subir y Graficar</button>
            </div>
        </form>
         <div class="d-flex justify-content-end">
             <button class="btn btn-secondary" onclick="regresarPortada()">Volver a Portada</button>
         </div>
        </div>
      </div>
    
    <!-- Vista 9: Vista de graficas -->
    <div id="view-graficas" class="view">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2>Visualización de Datos</h2>
            <div>
                <button class="btn btn-info" onclick="mostrarContenido()">Ver Tabla de Datos</button>
                <button class="btn btn-secondary" onclick="irASeleccionarArchivo()">Cargar otro archivo</button>
            </div>
        </div>
        <div class="row">
            <div class="col-12 mb-4">
                <div class="card"><div class="card-body"><div id="chart" style="width: 100%; height: 500px;"></div></div></div>
            </div>
            <div class="col-12 mb-4">
                <div class="card"><div class="card-body"><div id="chart-tiempo" style="width: 100%; height: 500px;"></div></div></div>
            </div>
            <div class="col-12 mb-4">
                <div class="card"><div class="card-body"><div id="chart-viento" style="width: 100%; height: 500px;"></div></div></div>
            </div>
        </div>
    </div>

    <!-- Vista 10: Vista de contenido -->
    <div id="view-contenido" class="view">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2>Tabla de Datos</h2>
            <div>
                <button class="btn btn-info" onclick="mostrarGraficas()">Ver Gráficas</button>
                <button class="btn btn-secondary" onclick="irASeleccionarArchivo()">Cargar otro archivo</button>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div id="tabla-container" class="table-responsive">
                    <!-- La tabla se generará aquí con JS -->
                </div>
            </div>
        </div>
    </div>
    

  </main>
  <footer class="footer mt-auto py-3 bg-white border-top">
    <div class="container text-center">
      <span class="text-muted">© 2025 - Proyecto de Instrumentación Meteorológica</span>
    </div>
  </footer>
  <!--Librerias-->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

  <script src="{{ url_for('static', filename='scripts/app.js')}}"></script>

</body>
</html>
